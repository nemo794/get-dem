# ESA-Specific Instructions

To emulate execution of the Get DEM algorithm in the ESA MAAP system, you must
have [Docker](https://www.docker.com/get-started/) installed.

Once installed, you must build a Docker image using the following command (this
assumes your current directory is the root of this repository, not the directory
containing these instructions):

```plain
docker build -t esa-get-dem -f esa/Dockerfile .
```

Take note of the trailing dot (`.`) on the line above.  It is required!

Once the image is built (it may take a couple of minutes), you're now ready to
run the algorithm in a Docker container in a manner similar to how it would be
run in the ESA MAAP system.  The general form of the command to run the
algorithm in a Docker container is the following:

```plain
docker run -t -v ./output/esa:/projects/data/output esa-get-dem --bbox 'LEFT BOTTOM RIGHT TOP' --compute BOOLEAN
```

where:

- `LEFT` is the left longitude of your desired bounding box
- `BOTTOM` is the bottom latitude of your desired bounding box
- `RIGHT` is the right longitude of your desired bounding box
- `TOP` is the top latitude of your desired bounding box
- `BOOLEAN` is a "flag" indicating whether or not you wish to perform
  CPU-intensive, multi-core computations.  If you wish to perform such
  computations, specify a value of `true` (case-insensitive, so `TRUE`, `True`,
  etc., also work).  Otherwise, *any* other value will be interpreted to mean
  that you do *not* wish to perform such computations.

Take careful note of the single quotes (double quotes work as well) surrounding
the entirety of all 4 bounding box coordinates.  These are required in order for
the 4 coordinates to be treated as a single bounding box input value because
they are space-separated.

Here is an example *with* computation:

```plain
docker run -t -v ./output/esa:/projects/data/output esa-get-dem --bbox '-118.06817 34.22169 -118.05801 34.22822' --compute true
```

Here is an example using the same bounding box as above, but with *no
computation* (the `--compute` flag is arbitrarily specified as `false`, but any
value other that `true` [case-insensitive], will trigger computation):

```plain
docker run -t -v ./output/esa:/projects/data/output esa-get-dem --bbox '-118.06817 34.22169 -118.05801 34.22822' --compute false
```

In addition to output written to your console, you will find that the algorithm
creates a directory named `output/esa` and writes the following files there:

- `dem.tif`: GeoTIFF generated by the `sardem` library
- `elapsed.json`: simple file containing the elapsed runtime (seconds) of the
  main functions of the algorithm
- `profile.json`: detailed profiling metrics captured by
  [Scalene](https://github.com/plasma-umass/scalene)
- `simple_profile.json`: minimal set of profile metrics pulled from
  `elapsed.json` and `profile.json`
